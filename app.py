import hashlib
import time
import requests

url = "https://task.zostansecurity.ninja/"
a = requests.get(url)
time.sleep(1)
a = requests.get(f"{url}{a.text[-104:]}")
time.sleep(1)
url = f"{url}?step=2"
headers = {
    "X-challenge": f"{a.text[-92:-26].strip()}",
    "X-timestamp": f"{a.text[-11:].strip()}"
}
a = requests.get(url, headers=headers)
url = "https://task.zostansecurity.ninja/"
url = f"{url}?step=3"
challenge = a.text[172:237].rstrip()
timestamp = a.text[251:262].rstrip("\n")
hash_dict = a.text[342:984]
# Usuń nawiasy klamrowe i podziel tekst po przecinkach
pary = hash_dict.strip('{}').split(',')
# Stwórz słownik, dzieląc każdą parę klucz-wartość po dwukropku ":"
slownik = {}
for para in pary:
    klucz, wartosc = para.split(':')
    slownik[klucz.strip().strip('"')] = wartosc.strip().strip('"')
hash_dict = slownik
sorted_keys = sorted(hash_dict.keys())
flattened = "&".join([f"{key}={hash_dict[key]}" for key in sorted_keys])
hash_result = hashlib.sha256(flattened.encode()).hexdigest()
data = {
    "challenge": challenge,
    "timestamp": timestamp,
    "hash": hash_result
}
response = requests.post(url, data=data)
print(response.text)
def download_file(url, filename):
    response = requests.post(url, data=data)
    with open(filename, 'wb') as file:
        file.write(response.content)
    print(f"Pobrano plik {filename} z {url}")
if __name__ == "__main__":
    url = "https://task.zostansecurity.ninja"
    filename = "gpg.asc"
    download_file(url, filename)
